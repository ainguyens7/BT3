$(document).ready(function () {    $.getJSON("http://narutodaichien.com/social/extensionpopup", function (data) {        var marr = [];        $.each(data, function (key, val) {            marr[key] = val;        });        setBanner(marr["banner"]);        setNews(marr["news"]);        setRecentServer(marr["servers"]);        setServers(marr["servers"]);    });	});chrome.runtime.onMessage.addListener(function(request, sender) {  if (request.action == "getSource") {    message.innerText = request.source;  }});var str2DOMElement = function(html) {    var frame = document.createElement('iframe');    frame.style.display = 'none';    document.body.appendChild(frame);                 frame.contentDocument.open();    frame.contentDocument.write(html);    frame.contentDocument.close();    var el = frame.contentDocument.body.firstChild;    document.body.removeChild(frame);    return el;}function onWindowLoad() {  var message = document.querySelector('#message');	 chrome.tabs.executeScript(null, {    file: "js/jquery.min.js"  }, function() {    // If you try and inject into an extensions page or the webstore/NTP you'll get an error    if (chrome.runtime.lastError) {      message.innerText = 'There was an error injecting script : \n' + chrome.runtime.lastError.message;    }  });  chrome.tabs.executeScript(null, {    file: "js/getPagesSource.js"  }, function() {    // If you try and inject into an extensions page or the webstore/NTP you'll get an error    if (chrome.runtime.lastError) {      message.innerText = 'There was an error injecting script : \n' + chrome.runtime.lastError.message;    }  }); }window.onload = onWindowLoad;function setBanner(banner){    if (banner)    {        var html = "<a target='_blank' href='" + banner.href + "'><img width='378' height='126' src='" + cdnUrl + banner.url + "' /></a>";        $("#banner").html(html);    }}function setNews(news){    var html = "";    var count = 0;    $.each(news, function (index, value) {        if (count < 3)        {            html += "<li>";            html += "<a href='" + rootUrl + "news/" + index + "' target='_blank'>" + value.title + "</a>";            html += "</li>";            count++;        }        else        {            return false;        }    });    $("#news-content").html(html);}function setRecentServer(servers){    var recent_server = localStorage.getItem('recent_server');    var html = "";    if (recent_server)    {        var server = false;        $.each(servers, function (index, value) {            if (index == recent_server)            {                server = value;                return false;            }        });        if (server)        {            html += "<a data-id='" + recent_server + "' href='" + rootUrl + "game/?server_id=" + recent_server + "' target='_blank'>" + server.name + "</a>";        }    }    html += "<a class='select-button'></a>";    $("#recent-server-content").html(html);    $("#recent-server-content .select-button").click(function () {        $("#servers-content").toggle(500);        $("#servers-content").getNiceScroll().resize();    });}function setServers(servers){    var html = "";    $.each(servers, function (index, value) {        html += "<li>";        html += "<a data-id='" + index + "' href='" + rootUrl + "game/?server_id=" + index + "' target='_blank'>" + value.name + "</a>";        html += "</li>";    });    $("#servers-content").html(html);    $("#servers-content li a").click(function () {        localStorage.setItem('recent_server', $(this).attr("data-id"));    });    $("#servers-content").niceScroll();}